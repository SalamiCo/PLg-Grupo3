

 Program → program ident illave SConsts STypes SVars SSubprogs SInsts fllave fin
        Program.tsh = creaTS()
        Program.dirh = 2
        SConsts.tsh = Program.tsh
        STypes.tsh = SConsts.ts
        SVars.tsh = STypes.ts
        SVars.dirh = SProgram.dirh
        SSubprogs.tsh = SVars.ts
        SInsts.tsh = SSubprogs.ts        
        Program.err = SConsts.err ∨ STypes.err ∨ SVars.err ∨ SSubprogs.err ∨ SInsts.err

    SConsts → const illave Consts fllave 
        Consts.tsh = SConsts.tsh
        SConsts.ts = Consts.ts
        SConsts.err = Consts.err

    SConsts → ɛ
        SConsts.ts = SConsts.tsh
        SConsts.err = false

    Consts → Consts pyc Const
        Consts1.tsh = Consts0.tsh
        Const.tsh = Consts1.ts
        Consts0.ts = añade(Const.ts, Const.id, Const.clase, Const.nivel, ?, Const.tipo, Const.valor)
        Consts.err = existe(Const.ts, Const.id)

    Consts → Const
        Const.tsh = Consts.tsh
        Consts.ts = añade(Const.ts, Const.id, Const.clase, Const.nivel, ?, Const.tipo, Const.valor)
        Consts.err = existe(Const.ts, Const.id)

    Const → const TPrim ident asig ConstLit 
        Const.ts = Const.tsh
        Const.id = ident.lex
        Const.clase = const
        Const.nivel = global
        Const.tipo = <t:TPrim.tipo, tam:1>
        Const.valor = ConstLit.valor
        Const.err = ¬(compatibles(TPrim.tipo, ConstLit.tipo))

    Const → ɛ
        Const.ts = Const.tsh
        Const.err = false

    ConstLit → Lit
        ConstLit.valor = Lit.valor
        ConstLit.tipo = Lit.tipo

    ConstLit → menos Lit
        ConstLit.valor = -(Lit.valor)
        ConstLit.tipo = -(Lit.tipo)

    STypes → tipos illave Types fllave 
        Types.tsh = STypes.tsh
        STypes.ts = Types.ts 
        STypes.err = Types.err

    STypes → ɛ
        STypes.ts = STypes.tsh
        STypes.err = false

    Types → Types pyc Type 
        Types1.tsh = Types0.tsh
        Type.tsh = Types1.ts
        Types0.ts = añade(Types1.ts, Type.id, Type.clase, Type.nivel, ?, Type.tipo)
        Types0.err = existe(Types1.ts, Type.id)

    Types → Type
        Type.tsh = Types.tsh
        Types.ts = añade(Type.ts, Type.id, Type.clase, Type.nivel, ?, Type.tipo)
        Types.err = existe(Type.ts, Type.id)


    Type → tipo TypeDesc ident 
        Type.ts = Type.tsh
        TypeDesc.tsh = Type.tsh
        Type.id = ident.lex
        Type.clase = Tipo
        Type.nivel = global
        //TODO no son iguales la 3 y la 4
        Type.tipo = TypeDesc.tipo 

    Type → ɛ
        Type.ts = Type.tsh
        Type.err = false

    SVars → vars illave Vars fllave 
        Vars.tsh = SVars.tsh
        Vars.dirh = SVars.dirh
        SVars.ts = Vars.ts
        SVars.dir = Vars.dir
        SVars.err = Vars.err

    SVars → ɛ
        SVars.ts = SVars.tsh
        SVars.dir = SVars.dirh
        SVars.err = false

    Vars → Vars pyc Var 
        Vars1.tsh = Vars0.tsh
        Vars1.dirh = Vars0.dirh
        Var.tsh = Vars1.ts
        Var.dirh = Vars1.dir
        Vars0.dir = Var.dir + desplazamiento(Var.tipo, Vars1.id)
        Vars0.ts = añade(Var.ts, Var.id, Var.clase, Var.nivel, Vars0.dir, Var.tipo)
        Vars0.err = existe(Var.ts, Var.id, Var.nivel)

    Vars → Var
        Var.tsh = Vars.tsh
        Var.dirh = Vars.dirh
        Vars.dir = Var.dir + desplazamiento(Var.tipo, Var.id)
        Vars.ts = añade(Var.ts, Var.id, Var.clase, Var.nivel, Var.dir, Var.tipo)
        Vars.err = existe(Var.ts, Var.id, Var.nivel)

    Var → var TypeDesc ident 
        Var.ts = Var.tsh
        Var.dir = Var.dirh
        Var.id = ident.lex
        Var.clase = Var
        Var.nivel = global
        //TODO lo mismo no son iguales
        Var.tipo = TypeDesc.tipo
        TypeDesc.tsh = Var.tsh

    Var → ɛ
        Var.ts = Var.tsh
        Var.dir = Var.dirh
        Var.err = false

    TypeDesc → TPrim
        TypeDesc.tipo = TPrim.tipo

    TypeDesc → TArray
        TypeDesc.tipo = TArray.tipo
        TArray.tsh = TypeDesc.tsh
        TypeDesc.err = TArray.err

    TypeDesc → TTupla
        TypeDesc.tipo = TTupla.tipo
        TTupla.tsh = TypeDesc.tsh
        TypeDesc.err = TTupla.err

    TypeDesc → ident
        TypeDesc.tipo = ident.lex
        TypeDesc.err = ¬existe(TypeDesc.tsh, ident.lex) ∨ TypeDesc.tsh[ident].clase != tipo

    TPrim → natural
        TPrim.tipo = natural
    
    TPrim → integer
        TPrim.tipo = integer

    TPrim → float
        TPrim.tipo = float

    TPrim → boolean
        TPrim.tipo = boolean
        
    TPrim → character
        TPrim.tipo = character

    Cast → char | int | nat | float

    TArray → TypeDesc icorchete ident fcorchete
        TypeDesc.tsh = TArray.tsh
        TArray.tsh = TypeDesc.tsh
        TArray.err = ¬existe(TArray.tsh, ident.lex) ∨ obtieneTipoString(ident) != nat ∨ TArray.tsh[ident].clase != constante

    TArray → TypeDesc icorchete litnat fcorchete
        TypeDesc.tsh = TArray.tsh
        TArray.tsh = TypeDesc.tsh

    TTupla → ipar Tupla fpar
        Tupla.tsh = TTupla.tsh
        TTupla.tipo = Tupla.tipo
        TTupla.err = Tupla.err

    TTupla → ipar fpar
        TTupla.err = false

    Tupla → TypeDesc coma Tupla
        TypeDesc.tsh = Tupla0.tsh
        Tupla1.tsh = Tupla0.tsh
        Tupla0.tipo = TypeDesc.tipo ++ Tupla1.tipo
        Tupla0.err = TypeDesc.err ∨ Tupla1.err

    Tupla → TypeDesc
        TypeDesc.tsh = Tupla.tsh
        Tupla.tipo = TypeDesc.tipo
        Tupla.err = TypeDesc.err

    SSubprogs → subprograms illave Subprogs fllave 
        Subprogs.tsh = SSubprogs.tsh
        SSbprogs.ts = Subprog.ts
        SSubprogs.err = Subprogrs.err

    SSubprogs → subprograms illave fllave 
        SSubprogs.tsh = Subprog.tsh

    SSubprogs → ɛ
        SSubprogs.tsh = Subprog.tsh
        SSubprogs.err = false

    Subprogs → Subprogs Subprog
        Subprogs1.tsh =  Subprogs0.tsh
        Subprog.tsh = Subprogs0.tsh 
        Subprogs0.ts = Subprog.ts  
        Subprogs0.err = Subprogs1.err ∨ Subprog.err

    Subprogs → Subprog
        Subprog.tsh = Subprogs.tsh
        Subprogs.ts = Subprog.ts
        Subprogs.err = Subprog.err

    Subprog → subprogram ident ipar SFParams fpar illave SVars SInsts fllave
        SFParams.dirh = 0
        SFParams.tsh = CreaTS(Subprog.ts)
        SVars.tsh = SFParams.ts
        SVars.dirh = SFParams.dir
        SInsts.tsh = SVars.ts
        Subprog.ts = añade(Subprog.tsh, ident, subprog, global, ? , <dir:Subprog.etqh, params:SFParams.params>)
        Subprog.err = existe(Subprog.tsh, ident) ∨ SParams.err ∨ SVars.err ∨ SInsts.err ∨ parametrosNoRepetidos(SParams.ts, ident)

    SFParams → FParams 
        FParams.tsh = SFParams.tsh
        SFParams.ts = FParams.ts
        FParams.dirh = SFParams.dirh
        SFParams.dir = FParams.dir
        SFParams.params = FParams.params
        SFParams.err = FParams.err

    SFParams → ɛ
        SFParams.ts = SFParams.tsh
        SFParams.dir = SFParams.dirh
        SFParams.params = []
        SFParams.err = false

    FParams → FParams coma FParam 
        FParams1.tsh = FParams0.tsh
        FParams1.dirh = FParams0.dirh
        FParam.tsh = FParams1.tsh
        FParam.dirh = FParams1.dirh
        FParams0.dir = FParam.dir + desplazamiento(FParam.tipo, FParam.id) 
        FParams0.ts = añade(FParam.ts, FParam.id, FParam.clase, FParam.nivel, FParam.dir, FParam.tipo)
        FParams0.params = FParams1.params ++ FParam.params
        FParams0.err = existe(FParam.ts, FParam.id, FParam.nivel)

    FParams → FParam
        FParam.dirh = FParams.dirh
        FParam.tsh = FParams.tsh
        FParams.ts = añade(FParam.ts, FParam.id, FParam.clase, FParam.nivel, FParam.dir, FParam.tipo)
        FParams.dir = FParam.dir + desplazamiento(FParam.tipo, FParam.id)
        FParams.params = FParap.params
        FParams.err = existe(FParam.ts, FParam.id, FParam.nivel)

    FParam → TypeDesc ident 
        FParam.ts = FParam.tsh
        FParam.dir = FParam.dirh 
        Fparam.id = ident.lex
        FParam.clase = pvalor
        FParam.nivel = local
        FParam.tipo = (si (TypeDesc.tipo== TPrim) {<t:TypeDesc.tipo, tam:1>}
                   si no {<t:ref, id:FParam.id, tam: desplazamiento(TypeDesc.tipo, Param.id)>} )
        FParam.params = [<id:FParam.id, tam:desplazamiento(TypeDesc.tipo, Param.id), ref:falso, despl:DParam.dirh>]
        TypeDesc.tsh = FParam.tsh

    FParam → TypeDesc mul ident
        FParam.ts = FParam.tsh
        FParam.dir =  FParam.dirh 
        Fparam.id = ident.lex
        FParam.clase = pvariable
        FParam.nivel = local
        FParam.tipo = (si (TypeDesc.tipo == TPrim) {<t:TypeDesc.tipo, tam:1>}
                   si no {<t:ref, id:FParam.id, tam: 1>} )
        FParam.params = [<id:FParam.id, tam:desplazamiento(TypeDesc.tipo, Param.id), ref:cierto, despl:DParam.dirh>]
        TypeDesc.tsh = FParam.tsh
   
    Lit → LitBool 
        Lit.valor = LitBool.valor
        Lit.tipo = LitBool.tipo

    Lit → LitNum
        Lit.valor = LitNum.valor
        Lit.tipo = LitNum.tipo

    Lit → litChar
        Lit.valor = stringToChar(litchar)
        Lit.tipo = character

    LitBool → true 
        LitBool.valor = true
        Litbool.tipo = boolean

    LitBool → false
        LitBool.valor = false
        Lit.tipo = boolean

    LitNum → litNat
        LitNum.valor = stringToNat(litnat)
        LitNum.tipo = natural

    LitNum → litFloat
        LitNum.valor = stringToFloat(litfloat)
        LitNum.tipo = float