


 Program → program ident illave SConsts STypes SVars SSubprogs SInsts fllave fin
        Program.tsh = creaTS()
        Program.dirh = 2
        SConsts.tsh = Program.tsh
        SConsts.dirh = Program.dirh
        STypes.tsh = SConsts.ts
        STypes.dirh = SConsts.dir
        SVars.tsh = STypes.ts
        SVars.dirh = STypes.dir
        SSubprogs.tsh = SVars.ts
        SSubprogs.dirh = SVars.dir
        SInsts.tsh = SVars.ts
        SVars.nivelh = global
        Program.err = SConsts.err ∨ STypes.err ∨ SVars.err ∨ SSubprogs.err ∨ SInsts.err


    SConsts → const illave Consts fllave 
        Consts.tsh = SConsts.tsh
        Consts.dirh = SConsts.dirh
        SConsts.ts = Consts.ts
        SConsts.dir = Consts.dir
        SConsts.err = Consts.err

    SConsts → ɛ
        SConsts.ts = SConsts.tsh
        SConsts.dir = SConsts.dirh
        SConsts.err = false

    Consts → Consts pyc Const
        Consts1.tsh = Consts0.tsh
        Consts1.dirh = Consts0.dirh
        Const.tsh = Consts1.ts
        Const.dirh = Consts1.dir
        Consts0.dir = Const.dir + desplazamiento(Const.tipo, Const.id)
        Consts0.ts = añade(Const.ts, Const.id, Const.clase, Const.nivel, Conts0.dir, Const.tipo, Const.valor)
        Consts.err = existe(Const.ts, Const.id)

    Consts → Const
        Const.tsh = Consts.tsh
        Const.dirh = Consts.dirh
        Const.nivelh = Consts.nivelh
        Consts.dir = Const.dir + desplazamiento(Const.tipo, Const.id)
        Consts.ts = añade(Const.ts, Const.id, Const.clase, Const.nivel, Const.dir, Const.tipo, Const.valor)
        Consts.err = existe(Const.ts, Const.id)

    Const → const TPrim ident asig ConstLit 
        Const.ts = Const.tsh
        Const.dir = Const.dirh
        Const.id = ident.lex
        Const.clase = const
        Const.nivel = global
        Const.tipo = <t:TPrim.tipo, tam:1>
        Const.valor = ConstLit.valor
          // TODO
        // añadir valor aquí
        Const.err = ¬(compatibles(TPrim.tipo, ConstLit.tipo))

    Const → ɛ
        Const.ts = Const.tsh
        Const.dir = Const.dirh
        Const.err = false

    ConstLit → Lit
        ConstLit.valor = Lit.valor
        ConstLit.tipo = Lit.tipo

    ConstLit → menos Lit
        ConstList.valor = -(Lit.valor)
        ConstLit.tipo = Lit.tipo

    STypes → tipos illave Types fllave 
        Types.tsh = STypes.tsh
        Types.dirh = STypes.dirh
        STypes.ts = Types.ts 
        STypes.dir = Types.dir 

    STypes → ɛ
        STypes.ts = STypes.tsh
        STypes.dir = STypes.dirh

    Types → Types pyc Type 
        Types1.tsh = Types0.tsh
        Types1.dirh = Types0.dirh
        Type.tsh = Types1.ts
        Type.dirh = Types1.dir
        Types0.dir = Type.dir + desplazamiento(Type.tipo, Types0.id)
        Types0.ts = añade(Types1.ts, Type.id, Type.clase, Type.nivel, Types0.dir, Type.tipo)

    Types → Type
        Type.tsh = Types.tsh
        Type.dirh = Types.dirh
        Types.dir = Type.dir + desplazamiento(Type.tipo, Type.id)
        Types.ts = añade(Type.ts, Type.id, Type.clase, Type.nivel, Type.dir, Type.tipo)


    Type → tipo TypeDesc ident 
        Type.ts = Type.tsh
        Type.dir = Type.dirh
        Type.id = ident.lex
        Type.clase = Tipo
        Type.tipo = <t:TypeDesc.type, tipo:obtieneCTipo(TypeDesc), tam:desplazamiento(obtieneCTipo(TypeDesc), Type.id)> //TODO mirar como añadir el tamaño al tipo

    Type → ɛ
        Type.ts = Type.tsh
        Type.dir = Type.dirh

    SVars → vars illave Vars fllave 
        Vars.tsh = SVars.tsh
        Vars.dirh = SVars.dirh
        Vars.nivelh = SVars.nivelh
        SVars.ts = Vars.ts
        SVars.dir = Vars.dir

    SVars → ɛ
        SVars.ts = SVars.tsh
        SVars.dir = SVars.dirh

    Vars → Vars pyc Var 
        Vars1.tsh = Vars0.tsh
        Vars1.dirh = Vars0.dirh
        Vars1.nivelh = Vars0.nivelh
        Var.nivelh = Vars0.nivelh
        Var.tsh = Vars1.ts
        Var.dirh = Vars1.dir
        Vars0.dir = Var.dir + desplazamiento(Var.tipo, Vars1.id)
        Vars0.ts = añade(Var.ts, Var.id, Var.clase, Var.nivel, Vars0.dir, Var.tipo)

    Vars → Var
        Var.tsh = Vars.tsh
        Var.dirh = Vars.dirh
        Var.nivelh = Vars.nivelh
        Vars.dir = Var.dir + desplazamiento(Var.tipo, Var.id)
        Vars.ts = añade(Var.ts, Var.id, Var.clase, Var.nivel, Var.dir, Var.tipo)

    Var → var TypeDesc ident 
        Var.ts = Var.tsh
        Var.dir = Var.dirh
        Var.id = ident.lex
        Var.clase = Var
        Var.nivel = Var.nivelh
        Var.tipo = (si (TypeDesc.tipo == TPrim) {<t:TypeDesc.tipo, tam:1>}
                   si no {<t:ref, id:Var.id, tam: desplazamiento(TypeDesc.tipo, Var.id)>} )

    Var → ɛ
        Var.ts = Var.tsh
        Var.dir = Var.dirh

    SSubprogs → subprograms illave Subprogs fllave 
        Subprogs.tsh = SSubprogs.tsh

    SSubprogs → subprograms illave fllave 

    SSubprogs → ɛ

    Subprogs → Subprogs Subprog
        Subprogs1.tsh =  Subprogs0.tsh
        Subprog.tsh = Subprogs0.tsh   

    Subprogs → Subprog
        Subprog.tsh = Subprogs.tsh

    Subprog → subprogram ident ipar SFParams fpar illave SVars SInsts fllave
        SFParams.dirh = 0
        SFParams.tsh = CreaTS(añade(ident, subprog, global, ? , TODO))
        SVars.tsh = SFParams.ts
        SVars.dirh = SFParams.dir
        SInsts.tsh = SVars.ts
        SVars.nivelh = local

    SFParams → FParams 
        FParams.tsh = SFParams.tsh
        SFParams.ts = FParams.ts
        FParams.dirh = SFParams.dirh
        SFParams.dir = FParams.dir

    SFParams → ɛ
        SFParams.ts = SFParams.tsh
        SFParams.dir = SFParams.dirh

    FParams → FParams coma FParam 
        FParams1.tsh = FParams0.tsh
        FParams1.dirh = FParams0.dirh
        FParam.tsh = FParams1.tsh
        FParam.dirh = FParams1.dirh
        FParams0.dir = FParam.dir + desplazamiento(FParam.tipo, FParam.id) 
        FParams0.ts = añade(FParam.ts, FParam.id, FParam.clase, FParam.nivel, FParam.dir, FParam.tipo)

    FParams → FParam
        FParam.dirh = FParams.dirh
        FParam.tsh = FParams.tsh
        FParams.ts = añade(FParam.ts, FParam.id, FParam.clase, FParam.nivel, FParam.dir, FParam.tipo)
        FParams.dir = FParam.dir + desplazamiento(FParam.tipo, FParam.id)

    FParam → TypeDesc ident 
        FParam.ts = FParam.tsh
        FParam.dir = FParam.dirh 
        Fparam.id = ident.lex
        FParam.clase = pvalor
        FParam.nivel = local
        FParam.tipo = (si (TypeDesc.tipo== TPrim) {<t:TypeDesc.tipo, tam:1>}
                   si no {<t:ref, id:FParam.id, tam: desplazamiento(TypeDesc.tipo, Param.id)>} )

    FParam → TypeDesc mul ident
        FParam.ts = FParam.tsh
        FParam.dir =  FParam.dirh 
        Fparam.id = ident.lex
        FParam.clase = pvariable
        FParam.nivel = local
        FParam.tipo = (si (TypeDesc.tipo == TPrim) {<t:TypeDesc.tipo, tam:1>}
                   si no {<t:ref, id:FParam.id, tam: 1>} )

    TTupla → ipar Tupla fpar
        Tupla.tsh = TTupla.tsh
        TTupla.tipo = Tupla.tipo

    TTupla → ipar fpar

    Tupla → TypeDesc coma Tupla
        TypeDesc.tsh = Tupla0.tsh
        Tupla1.tsh = Tupla0.tsh
        Tupla.tipo = TypeDesc.tipo ++ Tupla.tipo

    Tupla → TypeDesc
        TypeDesc.tsh = Tupla.tsh
        Tupla.tipo = TypeDesc.tipo

    Lit → LitBool 
        Lit.valor = LitBool.valor

    Lit → LitNum
        Lit.valor = LitNum.valor

    Lit → litChar
        Lit.valor = stringToChar(litchar)

    LitBool → true 
        LitBool.valor = true

    LitBool → false
        LitBool.valor = false

    LitNum → litNat
        LitNum.valor = stringToNat(litnat)

    LitNum → litFloat
        LitNum.valor = stringToFloat(litfloat)